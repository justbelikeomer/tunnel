#!/bin/bash

PORT=$1
if [[ -z "$PORT" ]]; then
  echo "Usage: tunnel make <local-port>"
  exit 1
fi

DB_FILE="/tmp/port_tunnels.db"
mkdir -p /tmp
touch "$DB_FILE"

TMPFILE=$(mktemp)

ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -N -R 0:localhost:$PORT tunnel@tunnel.extremenodes.dpdns.org >"$TMPFILE" 2>&1 &

sleep 2
cat "$TMPFILE"
